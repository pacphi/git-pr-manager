# setup - Configuration Setup and Management

The `setup` command provides interactive tools for configuring Git PR CLI.

## Synopsis

```bash
git-pr-cli setup <subcommand> [flags]
```

## Subcommands

### wizard - Interactive Configuration Setup

```bash
git-pr-cli setup wizard [flags]
```

**Description**: Launches an interactive wizard that discovers repositories and generates configuration.

**Options**:

```bash
      --additive               Add to existing configuration instead of replacing
      --output string          Output file path (default "config.yaml")
      --provider strings       Configure only specific providers (github,gitlab,bitbucket)
```

**Example**:

```bash
# Full interactive setup
git-pr-cli setup wizard

# Add repositories to existing config
git-pr-cli setup wizard --additive

# Configure only GitHub repositories
git-pr-cli setup wizard --provider=github
```

### validate - Validate Configuration

```bash
git-pr-cli setup validate [flags]
```

**Description**: Validates existing configuration file syntax and connectivity.

### backup - Backup Configuration

```bash
git-pr-cli setup backup [flags]
```

**Description**: Creates a backup of current configuration.

**Options**:

```bash
      --output string          Backup file path (default "config.backup.yaml")
```

### restore - Restore Configuration

```bash
git-pr-cli setup restore [flags]
```

**Description**: Restores configuration from backup.

**Options**:

```bash
      --backup string          Backup file to restore (default "config.backup.yaml")
```

## Setup Wizard Walkthrough

The interactive wizard guides you through complete configuration:

### Step 1: Provider Authentication

```text
Git PR CLI Setup Wizard
========================

Testing provider authentication...

GitHub:
  Token: ✅ Valid (expires: 2025-12-31)
  Scopes: repo, read:org ✅
  Rate limit: 4,987/5,000 remaining

GitLab:
  Token: ✅ Valid (expires: never)
  Scopes: api, read_repository, write_repository ✅
  Rate limit: 1,994/2,000 remaining

Bitbucket:
  Username: ✅ Valid
  App Password: ✅ Valid
  Rate limit: 998/1,000 remaining

Continue with repository discovery? [Y/n]:
```

### Step 2: Repository Discovery

```text
Discovering repositories...

GitHub (found 47 repositories):
  ✅ myorg/web-app (has dependabot PRs)
  ✅ myorg/api-service (has renovate PRs)
  ✅ myorg/mobile-app (has dependabot PRs)
  ⚠️  myorg/legacy-system (no automation PRs)
  ...

GitLab (found 12 repositories):
  ✅ group/project1 (has renovate MRs)
  ✅ group/project2 (has dependabot MRs)
  ...

Select repositories to configure:
  [a] All repositories with automation PRs (32 repos)
  [s] Select specific repositories
  [f] Filter by pattern
  [n] None (skip provider)

Choice: a
```

### Step 3: Configuration Options

```text
Configuration Options
=====================

Default merge strategy:
  [1] Squash (recommended for dependencies)
  [2] Merge commit
  [3] Rebase

Choice: 1

PR Filters:
✅ dependabot[bot]
✅ renovate[bot]
✅ github-actions[bot]

Add more trusted actors? [y/N]: n

Skip labels:
✅ do-not-merge
✅ wip
✅ draft
✅ hold

Add more skip labels? [y/N]: n

Max PR age (skip older PRs):
  [1] No limit
  [2] 30 days
  [3] 7 days
  [4] Custom

Choice: 2
```

### Step 4: Notifications (Optional)

```text
Notification Setup (Optional)
=============================

Configure Slack notifications? [y/N]: y
  Webhook URL: https://hooks.slack.com/services/...
  Channel: #deployments
  Test notification? [Y/n]: y
  ✅ Slack test successful

Configure email notifications? [y/N]: n

Configure other notifications? [y/N]: n
```

### Step 5: Review and Save

```text
Configuration Preview
=====================

Repositories: 32 total
├── GitHub: 28 repositories
├── GitLab: 3 repositories
└── Bitbucket: 1 repository

PR Filters:
├── Allowed actors: dependabot[bot], renovate[bot], github-actions[bot]
├── Skip labels: do-not-merge, wip, draft, hold
└── Max age: 30 days

Merge Strategy: squash (default)

Notifications:
└── Slack: #deployments

Save configuration to config.yaml? [Y/n]: y
✅ Configuration saved successfully

Run validation check? [Y/n]: y
✅ All 32 repositories accessible
✅ All authentication valid
✅ Configuration ready to use

Next steps:
  1. Test with: git-pr-cli check --dry-run
  2. Start automation: git-pr-cli merge --dry-run
  3. Set up monitoring: git-pr-cli watch
```

## Generated Configuration

The wizard creates a complete configuration file:

```yaml
# Generated by git-pr-cli setup wizard
# Created: 2025-01-15T10:30:00Z

pr_filters:
  allowed_actors:
    - "dependabot[bot]"
    - "renovate[bot]"
    - "github-actions[bot]"
  skip_labels:
    - "do-not-merge"
    - "wip"
    - "draft"
    - "hold"
  max_age: "30d"

repositories:
  github:
    - name: "myorg/web-app"
      auto_merge: true
      merge_strategy: "squash"
      require_checks: true
    - name: "myorg/api-service"
      auto_merge: true
      merge_strategy: "squash"
      require_checks: true
    # ... additional repositories

auth:
  github:
    token: "${GITHUB_TOKEN}"
  gitlab:
    token: "${GITLAB_TOKEN}"
  bitbucket:
    username: "${BITBUCKET_USERNAME}"
    app_password: "${BITBUCKET_APP_PASSWORD}"

notifications:
  slack:
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channel: "#deployments"
    enabled: true

behavior:
  concurrency: 5
  dry_run: false
  require_approval: false
```

## Advanced Options

### Additive Mode

Add repositories to existing configuration:

```bash
# Discover new repositories and add to config
git-pr-cli setup wizard --additive

# This preserves existing settings while adding new repos
```

### Provider-Specific Setup

Configure only specific providers:

```bash
# Setup only GitHub
git-pr-cli setup wizard --provider=github

# Setup multiple providers
git-pr-cli setup wizard --provider=github,gitlab
```

### Custom Output Location

```bash
# Save to custom location
git-pr-cli setup wizard --output=/path/to/config.yaml

# Save with timestamp
git-pr-cli setup wizard --output="config-$(date +%Y%m%d).yaml"
```

## Configuration Management

### Backup and Restore

```bash
# Create backup before changes
git-pr-cli setup backup

# Make changes...
git-pr-cli setup wizard

# Restore if needed
git-pr-cli setup restore
```

### Version Control

```bash
# Add config to git (without secrets)
cp config.yaml config.template.yaml
sed -i 's/\${[^}]*}/PLACEHOLDER/g' config.template.yaml
git add config.template.yaml
```

### Multiple Environments

```bash
# Development environment
git-pr-cli setup wizard --output=config.dev.yaml

# Production environment
git-pr-cli setup wizard --output=config.prod.yaml

# Use with specific config
git-pr-cli --config=config.dev.yaml check
```

## Troubleshooting Setup

### Authentication Failures

```bash
# Test authentication separately
export GITHUB_TOKEN="your-token"
curl -H "Authorization: token $GITHUB_TOKEN" https://api.github.com/user

# Run setup with debug logging
git-pr-cli --log-level=debug setup wizard
```

### Repository Discovery Issues

```bash
# Check specific repository access
git-pr-cli validate --check-repos --repos="owner/repo"

# Review token permissions
# GitHub: repo, read:org scopes needed
# GitLab: api, read_repository scopes needed
# Bitbucket: repositories read permission needed
```

### Configuration Validation

```bash
# Validate generated config
git-pr-cli setup validate

# Check YAML syntax
yq eval . config.yaml

# Test configuration
git-pr-cli --config=config.yaml check --dry-run
```

## Best Practices

### Security

- Never commit actual tokens to version control
- Use environment variables for sensitive data
- Regularly rotate access tokens
- Use minimum required permissions

### Organization

- Use descriptive repository patterns
- Group similar repositories together
- Document custom configurations
- Regular config validation

### Testing

- Always test configuration with dry-run
- Start with a few repositories
- Validate before production use
- Monitor initial runs closely

## Related Commands

- [`validate`](validate.md) - Validate configuration
- [`check`](check.md) - Test PR discovery
- [`merge`](merge.md) - Test merge functionality
